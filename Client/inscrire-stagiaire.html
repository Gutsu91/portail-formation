<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inscrire un stagiaire | Forem Formation</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <link rel="stylesheet" href="additional-style.css">
</head>
<body>
  <header class="navbar has-shadow is-white">
    <figure class="navbar-brand">
      <a href="#" class="navbar-item p-4"><img src="./src/img/Logo-Forem-noir.png" alt="Logo du Forem"></a>
    </figure>
    <nav class="navbar-menu">
      <ul class="navbar-end" id="account-nav-link">
        <li class="navbar-item p-0 login-link"><a href="./login.html" class="navbar-item p-4">Connexion</a></li>
        <li class="navbar-item p-0 ge-link"><a href="./gestion-evaluation.html" class="navbar-item p-4">Remplir la GE</a></li>
        <li class="navbar-item has-dropdown is-hoverable p-0 stagiaire-link">
          <a href="./session.html" class="navbar-item p-4">
          Stagiaire</a>
        <ul class="navbar-dropdown">
          <li class="navbar-item"><a href="./inscrire-stagiaire.html">Inscrire un stagiaire</a></li>
          <li class="navbar-item"><a href="./session.html">Assigner une session</a></li>
        </ul></a></li>
        <li class="navbar-item p-0 session-link"><a href="./formation.html" class="navbar-item p-4">Sessions</a></li>
      </ul>
  </header>
  <main class="columns pt-6"style="min-height:70vh;">
    <section class="column is-4 is-offset-1">
      <h1 class="title">Inscrire un stagiaire</h1>
      <form method="post" id="inscrire-stagiaire">
        <div class="is-flex is-justify-content-space-between my-5">
          <div class="field" style="width:250px;">
            <label for="firstname" class="label">Prenom :
            <input type="text" class="input firstname" placeholder="Prénom du stagiaire" name="firstname"></label>
          </div>
          <div class="field" style="width:250px;">
            <label for="lastname" class="label"> Nom de famille :
            <input type="text" class="input lastname" placeholder="Nom du stagiaire" name="lastname"></label>
          </div>
        </div>
        <div class="is-flex is-justify-content-space-between my-5">
          <div class="field" style="width:250px;">
            <label for="email" class="label">Adresse email :
            <input type="email" class="input email" placeholder="Email du stagiaire" name="email"></label>
          </div>
          <div class="field" style="width:250px;">
            <label for="password" class="label"> Mot de passe :
            <input type="password" class="input password" placeholder="Mot de passe du stagiaire" name="password"></label>
          </div>
        </div>
        <input type="hidden" class="type-user" value="stagiaire">
        <div class="field">
          <label class="checkbox"><input type="checkbox" class="checkbox m-2">Inscrire le stagiaire à une formation</label>
        </div>
          <div class="is-flex is-justify-content-space-between my-5">
            <!-- <div class="field" style="width:250px;">
              <label for="metier" class="label">Métier :</label>
              <div class="select">
                <select name="metier" id="metier" disabled>
                <option value="" hidden selected disabled>Sélectionner un métier</option>
                <option value="">Webdesigner - Développeur Front-End</option>
                <option value="">Chargé de Communication Digitale</option>
              </select>
              </div>
            </div> -->
            <div class="field" style="width:250px;">
              <label for="session" class="label"> Session :</label>
              <div class="select">
                <select name="session" class="sessionSelect" id="session" disabled>
                <option value="" hidden selected disabled>Sélectionner une session</option>
                <option value="">INGRWF-10</option>
                <option value="">INGRWF-11</option>
              </select>
            </div>
            </div>
          </div>
          <div class="is-flex is-justify-content-space-around my-5">
            <input type="submit" value="Inscrire le stagiaire"class="button is-link submitButton" disabled style="width:30%;">
            <input type="reset" value="Réinitialiser"class="button" style="width:30%;">
          </div>
      </form>
    </section>
</main>
  <footer class="footer is-flex is-justify-content-space-between">
    <div class="content">&copy;2022</div>
    <a class="easter-egg">Wazaaah</a>
  </footer>
  <script>
    const enableSession = document.querySelector('.checkbox');
    const sessionSelect = document.querySelector('#session');
    //const metierSelect = document.querySelector('#metier')

    /* gestion du header */
const urlApi = 'http://localhost/Formation/API'
const loginLink = document.querySelector('.login-link')
const geLink = document.querySelector('.ge-link')
const stagiaireLink = document.querySelector('.stagiaire-link')
const sessionLink = document.querySelector('.session-link')
const formCreate = document.querySelector('#inscrire-stagiaire')
const submitButton = document.querySelector('.submitButton')
const prenomStagiaire = document.querySelector('.firstname')
const nomStagiaire = document.querySelector('.lastname')
const emailStagiaire = document.querySelector('.email')
const pwdStagiaire = document.querySelector('.password')
const isStagiaire = document.querySelector('.type-user')
let enableInscription = ''
let idNewUser = ''


    const UserType = sessionStorage.getItem('type_user')
switch(UserType){
  case null :
    window.location.href = './login.html'
    break
  case 'stagiaire':
    stagiaireLink.remove()
    sessionLink.remove()
    break
  default:
    geLink.remove()
    break
}
//
/* -------- Toggle inscription  à une formation  --------*/
enableSession.addEventListener('change', (e) => {
  console.log('checkbox')
  sessionSelect.toggleAttribute('disabled')
  enableSession.toggleAttribute('checked')
  // metierSelect.toggleAttribute('disabled')
})

/*-------------- toggle bouton inscription --------------*/
formCreate.addEventListener('keypress', e => {
  if(emailStagiaire.value !== "" && prenomStagiaire.value !== "" & nomStagiaire.value !== "" && pwdStagiaire.value !== "") {
    submitButton.removeAttribute('disabled')
  }
})

/* ---- fetch liste des sessions de formation -----*/
fetch(urlApi + '/session/')
.then(response=>response.json())
.then(response => {
  console.log(response)
  let template ='<option value="0" hidden selected disabled data-id="0">Sélectionner une session</option>'
  response.data.forEach(sess => {
    template +=`
              <option value="${sess.id_session}" data-id=${sess.id_session}>${sess.nom_session} - ${sess.date_debut}</option>
    `
  })
  sessionSelect.innerHTML = template

})
.catch(error=>console.log(error))

/* -------- Creation stagiaire --------*/
formCreate.addEventListener('submit', e => {
  e.preventDefault()
  fetch(urlApi + '/stagiaire/', {
    header: {'Content-Type' : 'applicaton/json'},
    method: 'POST',
    body: JSON.stringify({
    email: emailStagiaire.value,
    prenom_user: prenomStagiaire.value,
    nom_user: nomStagiaire.value,
    password: pwdStagiaire.value,
    type_user: isStagiaire.value
  })
})
  .then(response=>response.json())
  .then(response => {
    console.log(response)
    idNewUser = response.response['id_user']
    console.log('new user id ' + idNewUser)
    enableInscription = document.querySelector('input:checked')
  if(enableInscription !== null) {
    fetch(urlApi + '/inscription/', {
      method: 'POST',
      headers: {'Content-Type' : 'application/json'},
      body: JSON.stringify({
        id_user: idNewUser,
        id_session: sessionSelect.value
      })
    })
    .then(response => response.json())
    .then(response => {
      console.log(response)
    })
    .catch(error =>console.log(error))
  }
  })
  .catch(error => console.log(error))
    emailStagiaire.value = ""
    prenomStagiaire.value = ""
    nomStagiaire.value = ""
    pwdStagiaire.value = ""
    sessionSelect.value = 0
})



  </script>
</body>
</html>